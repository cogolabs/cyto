# Cyto Partials

## What are partials?
If you've used Mustache or a similar templating language before, you're probably familiar with the concept of partials. For those who aren't, [partials](https://mustache.github.io/mustache.5.html#Partials) are Mustache templates that can be rendered inside of another Mustache template.  The documentation has a great quote that I feel explains partials very well:

> You may want to think of partials as includes, imports, template expansion, nested templates, or subtemplates, even though those aren't literally the case here.

Partials are great because they allow you to break out repeated snippets of text in one or more Mustache templates and move them into their own Mustache templates. However, Cyto handles all of the Mustache rendering for you, so you might be wondering how to use partials in Cyto dependency files. Fortunately, Cyto does support using partials in dependency files! However, there are some small differences between how Cyto handles partials and how Mustache does, which will be explained in the rest of this document.

## How Cyto partials work

Cyto partials are Cyto templates: there's no special syntax to declare that a Cyto template is a partial. However, Cyto partials must meet a single requirement:  their `dependencies`  section in the `cyto.config.js` file must have exactly 1 element, which must be a string dependency. Other than that, Cyto partials are no different from normal Cyto templates.

Let's take a look at what the `cyto/partialsDemo`  template looks like:

`<path to GTL>/cyto/partialsDemo/cyto.config.js`
```js
module.exports = {
  templateId: "cyto/partialsDemo",
  dependencies: [
    'demo.txt',
  ],
  args: [
    {
      id: 'thingsToGreet',
      type: 'list',
      default: [],
    },
    {
      id: 'thingToGreet',
      default: 'Cyto expert :D'
    }
  ],
  options: {
    createDirectory: false,
  }
};
```

`<path to GTL>/cyto/partialsDemo/demo.txt`
```
This template is passed the same args as cyto/partialsDemo
{{> cyto/tutorial }}

These templates are passed the args from the `thingsToGreet` array
{{# thingsToGreet }}
{{> cyto/tutorial}}
{{/ thingsToGreet }}
```

As you can see, Cyto partials are used the same way as Mustache partials. To use them, we specify the `templateId` of the partial we'd like to include in the project and Cyto handles the rest. Here, we specify that we'd like to use the `cyto/tutorial` template as a partial. The generation process will look like this:

```bash
> cyto gen cyto/partialsDemo demo
Generating cyto/partialsDemo with id demo
? thingsToGreet:  foo,bar
? thingToGreet:  Cyto expert :D
Generating cyto/tutorial with id demo
Generating cyto/tutorial with id foo
? thingToGreet:  world
Generating cyto/tutorial with id bar
? thingToGreet:  other world
> cat demo.txt
This template is passed the same context as cyto/partialsDemo
Hello Cyto expert :D!

This file was generated by Connor Taylor with an id of demo using Cyto.

These templates are passed the context from the `thingsToGreet` arg
Hello world!

This file was generated by Connor Taylor with an id of foo using Cyto.
Hello other world!

This file was generated by Connor Taylor with an id of bar using Cyto.
```

## Caveats

You'll notice in the generation process that the first `cyto/tutorial` template didn't prompt us for a `thingToGreet`. Cyto partials, when generated, are passed an `args` object that supplies some arg values. In the `{{#thingsToGreet}}` section, each `cyto/tutorial` template's `args` object is the current item in the `thingsToGreet` array, which looks like this:

```js
[
  { id: 'foo' },
  { id: 'bar' },
]
```

Since the `thingToGreet` arg isn't set, we have to prompt the user for it. However, the first `cyto/tutorial` partial is passed the same `args` object that the `cyto/partialsDemo` template is passed since it is rendered outside of any section. The `cyto/partialsDemo` `args` object looks like this:

```js
{
  thingToGreet: 'Cyto expert :D',
  thingsToGreet: [
    { id: 'foo' },
    { id: 'bar' },
  ]
}
```

Since the `thingToGreet` argument is already set, Cyto will not prompt the user for it.

This partial generation process is the primary reason that Cyto's needs a custom implementation of [Mustache.js](https://github.com/janl/mustache.js). Since Cyto may need to prompt the user for arguments, the rendering process must be asynchronous. Otherwise, the renderer is almost exactly the same. The 2 other main differences is that Cyto's Mustache renderer does **not** escape HTML and handles whitespaces a bit differently.

## When to use Cyto partials

Cyto partials are great for text that you find yourself repeating in many dependency files. Some examples of Cyto partials I've found myself creating are `taylorc93/js-header-comment`, `jsdoc/param`, `licenses/apache-2`, and others.